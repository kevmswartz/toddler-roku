<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roku Control</title>
    <link rel="stylesheet" href="tailwind.css">
    <style>
        body {
            -webkit-tap-highlight-color: transparent;
        }
        button {
            touch-action: manipulation;
        }
        body.fireworks-open,
        body.timer-open {
            overflow: hidden;
        }
        .showcase-highlight {
            outline: 4px solid rgba(255, 255, 255, 0.7);
            outline-offset: 4px;
            transition: outline-offset 0.2s ease, outline-color 0.2s ease;
        }
        .timer-overlay {
            backdrop-filter: blur(16px);
            background: rgba(15, 23, 42, 0.72);
        }
        .timer-circle {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 0.2s linear;
        }
        .fireworks-overlay {
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(8px);
            background: rgba(15, 23, 42, 0.8);
            padding: clamp(1.5rem, 4vw, 3rem);
        }
        .fireworks-stage {
            position: absolute;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
            background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.12), rgba(15,23,42,0.65));
        }
        .fireworks-content {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            width: 100%;
            max-width: 640px;
            margin: auto;
            padding: 2.5rem 1.5rem 3rem;
            text-align: center;
        }
        .firework-particle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 9999px;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
            animation: fireworkTravel 1000ms ease-out forwards;
        }
        @keyframes fireworkTravel {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(0.5);
            }
            80% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translate(calc(var(--x) - 50%), calc(var(--y) - 50%)) scale(0.1);
            }
        }
        .tab-hidden {
            display: none !important;
        }
        #bottomTabNav {
            box-shadow: 0 -12px 32px rgba(15, 23, 42, 0.35);
        }
        #bottomTabNav button[data-tab-active="true"] {
            background: rgba(255, 255, 255, 0.18);
            color: #fff;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-500 via-indigo-600 to-purple-700 text-white">
    <!-- Settings Lock Button -->
    <button
        id="settingsLock"
        class="fixed left-5 top-5 z-50 flex h-16 w-16 items-center justify-center rounded-full bg-white/10 text-2xl shadow-lg backdrop-blur transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/60"
        onmousedown="startSettingsHold()"
        onmouseup="stopSettingsHold()"
        onmouseleave="stopSettingsHold()"
        ontouchstart="startSettingsHold()"
        ontouchend="stopSettingsHold()"
        onclick="handleSettingsClick(event)">
        <svg class="absolute inset-0 h-full w-full -rotate-90" aria-hidden="true">
            <circle
                id="progressCircle"
                cx="32"
                cy="32"
                r="26"
                stroke="#c4b5fd"
                stroke-width="4"
                stroke-dasharray="163"
                stroke-dashoffset="163"
                fill="none"></circle>
        </svg>
        <span class="relative">‚öôÔ∏è</span>
    </button>

    <button
        class="fixed right-5 top-5 z-50 flex h-12 w-12 items-center justify-center rounded-full bg-white/10 text-xl shadow-lg backdrop-blur transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/60"
        onclick="toggleTheme()"
        aria-label="Toggle theme">
        üåì
    </button>

    <!-- PIN Modal -->
    <div id="pinModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/70 backdrop-blur">
        <div class="w-[90%] max-w-xs rounded-3xl bg-white p-6 text-center text-slate-900 shadow-2xl">
            <h2 class="text-xl font-semibold text-indigo-600">Enter Grown-up PIN</h2>
            <p class="mt-1 text-sm text-slate-500">Hold the gear button, then type the code.</p>
            <div id="pinDisplay" class="mx-auto mt-4 flex h-12 w-full max-w-[220px] items-center justify-center gap-3 rounded-full bg-indigo-50 text-2xl font-semibold tracking-[0.65em] text-indigo-600">‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
            <div class="mt-6 grid grid-cols-3 gap-3">
                <button class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95" onclick="enterPin('1')">1</button>
                <button class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95" onclick="enterPin('2')">2</button>
                <button class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95" onclick="enterPin('3')">3</button>
                <button class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95" onclick="enterPin('4')">4</button>
                <button class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95" onclick="enterPin('5')">5</button>
                <button class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95" onclick="enterPin('6')">6</button>
                <button class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95" onclick="enterPin('7')">7</button>
                <button class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95" onclick="enterPin('8')">8</button>
                <button class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95" onclick="enterPin('9')">9</button>
                <button class="col-span-3 rounded-2xl bg-indigo-200 py-3 text-sm font-semibold uppercase tracking-wide text-indigo-700 transition hover:bg-indigo-300 active:scale-95" onclick="clearPin()">Clear</button>
                <button class="rounded-2xl bg-indigo-100 py-4 text-xl font-bold text-indigo-700 shadow-inner transition hover:bg-indigo-200 active:scale-95" onclick="enterPin('0')">0</button>
                <button class="rounded-2xl bg-slate-200 py-4 text-base font-semibold text-slate-700 shadow-inner transition hover:bg-slate-300 active:scale-95" onclick="closePinModal()">Cancel</button>
            </div>
        </div>
    </div>

    <main class="mx-auto flex min-h-screen w-full flex-col gap-6 px-4 pb-32 pt-20 sm:gap-8 md:px-8 md:pt-24 lg:px-12">
        <div id="statusMessage" class="status-message hidden"></div>
        <div id="advancedSettingsBanner" data-settings class="hidden flex flex-wrap items-center justify-between gap-3 rounded-3xl bg-white/15 px-5 py-4 text-sm font-semibold text-white shadow-2xl backdrop-blur md:px-6">
            <span>Advanced controls are unlocked. Make your changes, then tuck them away when you‚Äôre done.</span>
            <button
                class="rounded-2xl bg-white/20 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white shadow-md transition hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/50"
                onclick="hideSettings()">
                Hide Advanced Controls
            </button>
        </div>

        <section id="connectionSection" data-settings class="hidden rounded-3xl bg-white/15 p-6 shadow-2xl backdrop-blur md:p-8">
            <div class="flex items-start justify-between gap-6">
                <div>
                    <h1 class="text-3xl font-extrabold tracking-tight text-white md:text-4xl">üéÆ Roku Playground</h1>
                    <p class="mt-2 max-w-xl text-lg text-indigo-100">Big friendly buttons for tiny humans. Advanced tools stay tucked away until a grown-up unlocks them.</p>
                </div>
            </div>

            <div class="mt-8 grid gap-6 md:grid-cols-[3fr,2fr] md:items-end">
                <label class="flex flex-col gap-3">
                    <span class="text-sm font-semibold uppercase tracking-wide text-indigo-200">Roku IP Address</span>
                    <input
                        id="rokuIp"
                        type="text"
                        inputmode="decimal"
                        placeholder="192.168.1.100"
                        class="w-full rounded-2xl border border-white/20 bg-white/15 px-5 py-4 text-lg font-semibold text-white placeholder:text-indigo-200/50 shadow-inner focus:border-white/50 focus:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/50" />
                </label>
                <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-end">
                    <button
                        onclick="saveIp()"
                        class="rounded-2xl bg-white/20 px-6 py-4 text-base font-semibold text-white shadow-lg transition hover:bg-white/30 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-white/50">
                        Save IP
                    </button>
                    <button
                        onclick="checkStatus()"
                        class="rounded-2xl bg-white px-6 py-4 text-lg font-bold text-indigo-600 shadow-xl transition hover:scale-[1.02] hover:bg-indigo-50 focus:outline-none focus:ring-4 focus:ring-white/40">
                        Connect &amp; Load Roku
                    </button>
                </div>
            </div>
            <div id="deviceInfo" class="mt-4 hidden rounded-2xl bg-white/10 px-5 py-4 text-sm text-indigo-100"></div>
        </section>
        
        <section id="contentSourceSection" data-settings class="hidden rounded-3xl bg-white/15 p-6 shadow-2xl backdrop-blur md:p-8">
            <div class="flex flex-wrap items-start justify-between gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-white">Kid Button Source</h2>
                    <p class="mt-1 text-sm text-indigo-100">Pull toddler buttons from a remote JSON file and keep a local cache for offline use.</p>
                </div>
            </div>

            <div class="mt-6 grid gap-4 md:grid-cols-[2fr,1fr] md:items-start">
                <label class="flex flex-col gap-3">
                    <span class="text-sm font-semibold uppercase tracking-wide text-indigo-200">Remote JSON URL</span>
                    <input
                        id="toddlerContentUrl"
                        type="url"
                        inputmode="url"
                        placeholder="https://raw.githubusercontent.com/username/repo/main/toddler-content.json"
                        class="w-full rounded-2xl border border-white/20 bg-white/15 px-5 py-4 text-sm font-semibold text-white placeholder:text-indigo-200/50 shadow-inner focus:border-white/50 focus:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/50" />
                </label>
                <div class="flex flex-col gap-3 md:items-end">
                    <button
                        onclick="saveToddlerContentUrl()"
                        class="rounded-2xl bg-white/20 px-5 py-3 text-sm font-semibold text-white shadow-lg transition hover:bg-white/30 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-white/50">
                        Save URL &amp; Refresh
                    </button>
                    <button
                        onclick="refreshToddlerContent()"
                        class="rounded-2xl bg-white/15 px-5 py-3 text-sm font-semibold text-white shadow-lg transition hover:bg-white/25 focus:outline-none focus:ring-2 focus:ring-white/40">
                        Refresh from Remote
                    </button>
                    <button
                        onclick="clearToddlerContentCache()"
                        class="rounded-2xl bg-rose-500/30 px-5 py-3 text-sm font-semibold text-rose-50 shadow-lg transition hover:bg-rose-500/40 focus:outline-none focus:ring-2 focus:ring-rose-200/60">
                        Clear Cached Copy
                    </button>
                </div>
            </div>
            <p id="toddlerContentCacheInfo" class="mt-4 rounded-2xl bg-white/10 px-4 py-3 text-xs text-indigo-100"></p>
            <div class="mt-4 rounded-2xl bg-white/10 px-4 py-3 text-xs text-indigo-100">
                Bundled kid-mode buttons live in <code class="font-mono text-[11px] text-white">config/toddler/default.json</code>. Add a <code class="font-mono text-[11px] text-white">custom.json</code> beside it for local tweaks‚ÄîGit will ignore that file.
            </div>
            <div id="buttonHandlerCatalog" class="mt-6 hidden space-y-4 rounded-3xl bg-white/10 p-4 text-indigo-100 shadow-inner">
                <div>
                    <h3 class="text-base font-semibold text-white">Kid-mode Handler Catalog</h3>
                    <p class="mt-1 text-xs text-indigo-100/80">Use these button types and handlers when editing your config files.</p>
                </div>
                <div id="buttonHandlerList" class="grid gap-3 md:grid-cols-2 xl:grid-cols-3"></div>
                <div>
                    <h4 class="text-sm font-semibold text-white/90">Content Providers</h4>
                    <div id="contentProviderList" class="mt-2 grid gap-2 text-xs text-indigo-100"></div>
                </div>
            </div>
        </section>

        <section id="goveeSection" data-settings class="hidden rounded-3xl bg-white/15 p-6 shadow-2xl backdrop-blur md:p-8">
            <div class="flex flex-wrap items-start justify-between gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-white">Govee Lights (H60A1)</h2>
                    <p class="mt-1 text-sm text-indigo-100 max-w-2xl">Turn on LAN control in the Govee Home app, note the light‚Äôs IP, then paste it here to toggle power, dim, or change colors without the cloud.</p>
                </div>
            </div>

            <div class="mt-6 grid gap-6 md:grid-cols-[minmax(0,3fr)_minmax(0,2fr)] md:items-start">
                <div class="space-y-4">
                    <div class="grid gap-4 sm:grid-cols-2">
                        <label class="flex flex-col gap-2">
                            <span class="text-xs font-semibold uppercase tracking-wide text-indigo-200">Device IP</span>
                            <input
                                id="goveeIpInput"
                                type="text"
                                inputmode="decimal"
                                placeholder="192.168.1.120"
                                class="rounded-2xl border border-white/20 bg-white/15 px-4 py-3 text-sm font-semibold text-white placeholder:text-indigo-200/50 shadow-inner focus:border-white/50 focus:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/50" />
                        </label>
                        <label class="flex flex-col gap-2">
                            <span class="text-xs font-semibold uppercase tracking-wide text-indigo-200">Port (default 4003)</span>
                            <input
                                id="goveePortInput"
                                type="number"
                                inputmode="numeric"
                                min="1"
                                max="65535"
                                placeholder="4003"
                                class="rounded-2xl border border-white/20 bg-white/15 px-4 py-3 text-sm font-semibold text-white placeholder:text-indigo-200/50 shadow-inner focus:border-white/50 focus:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/50" />
                        </label>
                    </div>
                    <div class="flex flex-wrap gap-3">
                        <button
                            onclick="goveeSaveSettings()"
                            class="rounded-2xl bg-white/20 px-5 py-3 text-sm font-semibold text-white shadow-lg transition hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/50">
                            Save LAN Settings
                        </button>
                        <button
                            onclick="goveePower(true)"
                            class="rounded-2xl bg-white px-5 py-3 text-sm font-semibold text-indigo-600 shadow-lg transition hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-white/60">
                            Turn On
                        </button>
                        <button
                            onclick="goveePower(false)"
                            class="rounded-2xl bg-white/15 px-5 py-3 text-sm font-semibold text-white shadow-lg transition hover:bg-white/25 focus:outline-none focus:ring-2 focus:ring-white/40">
                            Turn Off
                        </button>
                    </div>

                    <div class="rounded-3xl bg-white/10 p-4">
                        <div class="flex items-center justify-between">
                            <span class="text-xs font-semibold uppercase tracking-wide text-indigo-200">Brightness</span>
                            <span id="goveeBrightnessValue" class="text-sm font-semibold text-white">80%</span>
                        </div>
                        <input
                            id="goveeBrightnessSlider"
                            type="range"
                            min="1"
                            max="100"
                            step="1"
                            class="mt-3 w-full accent-white/80"
                        />
                    </div>

                    <div class="space-y-3">
                        <span class="text-xs font-semibold uppercase tracking-wide text-indigo-200">Quick Colors</span>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="goveeSetWarmWhite()" class="h-10 w-10 rounded-full border-2 border-white/50 bg-[#ffe6c8] shadow-lg transition hover:-translate-y-0.5 hover:shadow-xl"></button>
                            <button onclick="goveeSetOceanBlue()" class="h-10 w-10 rounded-full border-2 border-white/50 bg-[#78b8ff] shadow-lg transition hover:-translate-y-0.5 hover:shadow-xl"></button>
                            <button onclick="goveeSetSunsetGlow()" class="h-10 w-10 rounded-full border-2 border-white/50 bg-[#ff9966] shadow-lg transition hover:-translate-y-0.5 hover:shadow-xl"></button>
                            <button onclick="goveeSetColor(255,0,120)" class="h-10 w-10 rounded-full border-2 border-white/50 bg-[#ff0078] shadow-lg transition hover:-translate-y-0.5 hover:shadow-xl"></button>
                            <button onclick="goveeSetColor(0,255,180)" class="h-10 w-10 rounded-full border-2 border-white/50 bg-[#00ffb4] shadow-lg transition hover:-translate-y-0.5 hover:shadow-xl"></button>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col gap-4 rounded-3xl bg-white/10 p-4">
                    <h3 class="text-sm font-semibold uppercase tracking-wide text-indigo-200">LAN Control Tips</h3>
                    <ul class="space-y-2 text-sm text-indigo-100/90">
                        <li>Enable LAN Control in the Govee Home app (Device Settings ‚Üí LAN Control).</li>
                        <li>Connect your phone and light to the same network, then note the IP shown in the app.</li>
                        <li>Lights speak HTTP JSON on port 4003. Only devices on your LAN can reach them.</li>
                    </ul>
                    <p class="text-xs text-indigo-100/80">You can trigger these helpers from kid buttons by using handlers like <code>goveePower</code>, <code>goveeSetColor</code>, or <code>goveeSetWarmWhite</code>.</p>
                </div>
            </div>

            <p id="goveeStatus" class="mt-4 rounded-2xl bg-white/10 px-4 py-3 text-sm font-semibold text-indigo-100">Enter the LAN IP to get started.</p>
        </section>

        <section id="kidQuickSection" class="rounded-3xl bg-white/15 p-6 shadow-2xl backdrop-blur md:p-8">
            <div class="flex flex-wrap items-start justify-between gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-white">Kid Favorites</h2>
                    <p class="mt-1 text-sm text-indigo-100 max-w-2xl">Tap a show tile or special button to launch it on the Roku.</p>
                </div>
            </div>
            <div id="toddlerQuickColumn" class="mt-6 grid gap-4 md:grid-cols-2 xl:grid-cols-3"></div>
        </section>

        <section id="toddlerControls" class="rounded-3xl bg-white/15 p-6 shadow-2xl backdrop-blur md:p-8">
            <div class="flex flex-wrap items-start justify-between gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-white">Remote</h2>
                    <p class="mt-1 text-sm text-indigo-100 max-w-2xl">Directional pad, magic buttons, and helpers for kid mode.</p>
                </div>
            </div>
            <div id="toddlerRemoteColumn" class="mt-6 flex flex-col gap-4"></div>
        </section>

        <section id="magicSection" class="rounded-3xl bg-white/15 p-6 shadow-2xl backdrop-blur md:p-8">
            <div class="flex flex-wrap items-start justify-between gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-white">Magic Time</h2>
                    <p class="mt-1 text-sm text-indigo-100 max-w-2xl">Quick sparks for little celebrations: start a timer, launch fireworks, or have the device speak on cue.</p>
                </div>
            </div>

            <div class="mt-6 grid gap-5 md:grid-cols-2 xl:grid-cols-3">
                <div class="flex flex-col gap-4 rounded-3xl bg-white/10 p-5 text-indigo-50 shadow-inner">
                    <div>
                        <h3 class="text-lg font-semibold text-white">Magic Timer</h3>
                        <p class="mt-1 text-sm text-indigo-100">Pick a duration and the countdown will pop up with the shimmering ring.</p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button type="button" data-magic-timer="180" class="rounded-2xl bg-white/20 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white transition hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/40">3 min</button>
                        <button type="button" data-magic-timer="300" class="rounded-2xl bg-white/20 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white transition hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/40">5 min</button>
                        <button type="button" data-magic-timer="600" class="rounded-2xl bg-white/20 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white transition hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/40">10 min</button>
                        <button type="button" data-magic-timer="900" class="rounded-2xl bg-white/20 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white transition hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/40">15 min</button>
                    </div>
                    <form id="magicTimerForm" class="space-y-3">
                        <label class="flex flex-col gap-2 text-xs font-semibold uppercase tracking-wide text-indigo-200">
                            Custom minutes
                            <div class="flex gap-2">
                                <input id="magicTimerMinutes" type="number" min="1" max="120" step="1" placeholder="e.g. 8" class="w-full rounded-2xl border border-white/20 bg-white/10 px-4 py-2 text-base font-semibold text-white placeholder:text-indigo-100/50 focus:border-white/40 focus:outline-none focus:ring-2 focus:ring-white/30" />
                                <button type="submit" class="rounded-2xl bg-white px-4 py-2 text-sm font-semibold uppercase tracking-wide text-indigo-600 shadow-lg transition hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-white/40">Start</button>
                            </div>
                        </label>
                    </form>
                    <button id="magicTimerCancel" type="button" class="self-start rounded-2xl bg-white/10 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40">Cancel Timer</button>
                </div>

                <div class="flex flex-col gap-4 rounded-3xl bg-white/10 p-5 text-indigo-50 shadow-inner">
                    <div>
                        <h3 class="text-lg font-semibold text-white">Fireworks Celebration</h3>
                        <p class="mt-1 text-sm text-indigo-100">Fill the screen with sparkle for bedtime victories or potty triumphs.</p>
                    </div>
                    <button id="magicFireworksButton" type="button" class="mt-auto rounded-2xl bg-gradient-to-r from-rose-400/80 to-amber-300/80 px-5 py-3 text-base font-semibold text-slate-900 shadow-lg transition hover:scale-[1.02] hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-white/40">Launch Fireworks</button>
                </div>

                <div class="flex flex-col gap-4 rounded-3xl bg-white/10 p-5 text-indigo-50 shadow-inner xl:col-span-1 md:col-span-2 xl:col-auto">
                    <div>
                        <h3 class="text-lg font-semibold text-white">Click to Say</h3>
                        <p class="mt-1 text-sm text-indigo-100">Type a phrase and the device will read it aloud with the friendliest voice it can find.</p>
                    </div>
                    <form id="magicSpeakForm" class="flex flex-col gap-3">
                        <textarea id="magicSpeakInput" rows="3" placeholder="Great job cleaning up every block!" class="w-full rounded-2xl border border-white/20 bg-white/10 px-4 py-3 text-base font-semibold text-white placeholder:text-indigo-100/50 focus:border-white/40 focus:outline-none focus:ring-2 focus:ring-white/30"></textarea>
                        <div class="flex flex-wrap gap-2">
                            <button type="submit" class="rounded-2xl bg-white px-5 py-3 text-base font-semibold text-indigo-600 shadow-lg transition hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-white/40">Say It</button>
                            <button type="button" id="magicSpeakStop" class="rounded-2xl bg-white/10 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40">Stop Voice</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <section id="nowPlayingSection" class="hidden rounded-3xl bg-white/15 p-6 shadow-2xl backdrop-blur md:p-8" data-settings>
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-white">Now Playing</h2>
                    <p class="mt-1 text-sm text-indigo-100">Live info from the Roku media player.</p>
                </div>
                <div class="flex flex-wrap gap-3">
                    <button onclick="checkNowPlaying()" class="rounded-2xl bg-white/10 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/20">Refresh</button>
                    <button onclick="showFullMediaInfo()" class="rounded-2xl bg-white/10 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/20">Show XML</button>
                </div>
            </div>
            <div id="nowPlayingInfo" class="mt-4 rounded-2xl bg-white/10 px-5 py-4 text-sm text-indigo-50"></div>
            <pre id="fullMediaInfo" class="mt-4 hidden max-h-80 overflow-auto rounded-2xl bg-slate-950/70 px-5 py-4 text-xs text-indigo-100"></pre>
        </section>

        <section id="appsSection" class="hidden rounded-3xl bg-white/15 p-6 shadow-2xl backdrop-blur md:p-8" data-settings>
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-white">Installed Apps</h2>
                    <p class="mt-1 text-sm text-indigo-100">Tap to launch, even if Roku hides the full list.</p>
                </div>
            </div>
            <div id="appsList" class="mt-6 grid gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
        </section>

        <section id="quickLaunchSection" class="hidden rounded-3xl bg-white/15 p-6 shadow-2xl backdrop-blur md:p-8" data-settings>
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-white">Quick Launch</h2>
                    <p class="mt-1 text-sm text-indigo-100">Favorite shows with one tap.</p>
                </div>
            </div>
            <div id="quickLaunchGrid" class="mt-6 grid gap-4 min-[480px]:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
        </section>

        <section id="deepLinkSection" class="hidden rounded-3xl bg-white/15 p-6 shadow-2xl backdrop-blur md:p-8" data-settings>
            <h2 class="text-2xl font-bold text-white">Deep Link Toolkit</h2>
            <p class="mt-1 text-sm text-indigo-100">Launch straight into hidden screens or playback positions.</p>

            <div class="mt-6 grid gap-4 rounded-3xl bg-slate-950/40 p-5">
                <input id="deepLinkAppId" type="text" class="rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-white placeholder:text-indigo-100/50 focus:border-white/40 focus:outline-none focus:ring-2 focus:ring-white/30" placeholder="App ID (e.g. 12 for Netflix)" />
                <input id="deepLinkContentId" type="text" class="rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-white placeholder:text-indigo-100/50 focus:border-white/40 focus:outline-none focus:ring-2 focus:ring-white/30" placeholder="Params (mediaType=movie&contentId=80014749)" />
                <button onclick="launchDeepLink()" class="rounded-2xl bg-white px-5 py-3 text-base font-semibold text-indigo-600 shadow-lg transition hover:bg-indigo-50">Launch Deep Link</button>
            </div>

            <details class="mt-4 rounded-2xl bg-white/10 p-4 text-sm text-indigo-50">
                <summary class="cursor-pointer text-base font-semibold text-white">Deep Link Examples</summary>
                <div class="mt-2 space-y-3 text-xs leading-relaxed">
                    <p><strong>Netflix (ID 12)</strong> ‚Äî movie: <code>mediaType=movie&amp;contentId=80014749</code>, series: <code>mediaType=series&amp;contentId=80057281</code></p>
                    <p><strong>YouTube (ID 837)</strong> ‚Äî <code>contentId=dQw4w9WgXcQ</code></p>
                    <p><strong>Hulu (ID 2213)</strong> ‚Äî <code>contentId=series/some-show-id</code></p>
                    <p><strong>Plex (ID 151908)</strong> ‚Äî <code>contentId=/library/metadata/12345</code></p>
                    <p><strong>Disney+ (ID 291097)</strong> ‚Äî try <code>contentId=SERIES_ID</code>, <code>seriesId=XXX</code>, <code>videoId=XXX</code>, <code>programId=XXX</code></p>
                </div>
            </details>

            <details class="mt-4 rounded-2xl bg-white/10 p-4 text-sm text-indigo-50">
                <summary class="cursor-pointer text-base font-semibold text-white">YouTube Launcher</summary>
                <div class="mt-3 space-y-3">
                    <p>Paste a YouTube URL to open it on Roku:</p>
                    <input id="youtubeUrl" type="text" class="w-full rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-white placeholder:text-indigo-100/50 focus:border-white/40 focus:outline-none focus:ring-2 focus:ring-white/30" placeholder="https://www.youtube.com/watch?v=OBqZDyVlFP8" />
                    <button onclick="launchYouTube()" class="w-full rounded-2xl bg-white px-5 py-3 text-base font-semibold text-indigo-600 shadow-lg transition hover:bg-indigo-50">Launch on Roku</button>
                    <div id="youtubeResult" class="hidden rounded-2xl bg-slate-950/60 px-4 py-3 text-xs"></div>
                </div>
            </details>

            <details class="mt-4 rounded-2xl bg-white/10 p-4 text-sm text-indigo-50">
                <summary class="cursor-pointer text-base font-semibold text-white">Disney+ ID Finder</summary>
                <div class="mt-3 space-y-3">
                    <p>Paste a Disney+ URL to grab the content ID:</p>
                    <input id="disneyUrl" type="text" class="w-full rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-white placeholder:text-indigo-100/50 focus:border-white/40 focus:outline-none focus:ring-2 focus:ring-white/30" placeholder="https://www.disneyplus.com/series/the-mandalorian/3jLIGMDYINqD" />
                    <button onclick="extractDisneyId()" class="w-full rounded-2xl bg-white/20 px-5 py-3 text-base font-semibold text-white shadow-lg transition hover:bg-white/30">Extract ID</button>
                    <div id="disneyIdResult" class="hidden rounded-2xl bg-slate-950/60 px-4 py-3 text-xs"></div>
                </div>
            </details>
        </section>

        <section id="remoteSection" class="hidden rounded-3xl bg-white/15 p-6 shadow-2xl backdrop-blur md:p-8" data-settings>
            <h2 class="text-2xl font-bold text-white">Advanced Remote</h2>
            <p class="mt-1 text-sm text-indigo-100">All the classic Roku controls laid out for quick access.</p>
            <div class="mt-6 grid grid-cols-3 gap-3 text-base sm:text-lg font-semibold">
                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('Back')">‚¨ÖÔ∏è Back</button>
                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('Home')">üè† Home</button>
                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('Info')">‚ÑπÔ∏è Info</button>

                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('Rev')">‚èÆÔ∏è Rev</button>
                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('Play')">‚èØÔ∏è Play</button>
                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('Fwd')">‚è≠Ô∏è Fwd</button>

                <div></div>
                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('Up')">‚¨ÜÔ∏è</button>
                <div></div>

                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('Left')">‚¨ÖÔ∏è</button>
                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('Select')">‚≠ï OK</button>
                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('Right')">‚û°Ô∏è</button>

                <div></div>
                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('Down')">‚¨áÔ∏è</button>
                <div></div>

                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('InstantReplay')">‚è™ Replay</button>
                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('VolumeUp')">üîä Vol+</button>
                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('VolumeMute')">üîá Mute</button>

                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('PowerOff')">‚èª Power</button>
                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('VolumeDown')">üîâ Vol-</button>
                <button class="remote-btn rounded-2xl bg-white/10 px-4 py-4 sm:px-5 sm:py-5 text-white shadow-inner transition hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 active:scale-95 touch-manipulation" onclick="sendKey('ChannelUp')">‚¨ÜÔ∏è CH+</button>
            </div>
        </section>

        <section id="macroSection" class="hidden rounded-3xl bg-white/15 p-6 shadow-2xl backdrop-blur md:p-8" data-settings>
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-white">Macro Magic</h2>
                    <p class="mt-1 text-sm text-indigo-100">Create sequences to launch apps, wait, and press buttons automatically.</p>
                </div>
                <button onclick="openMacroHelp()" class="rounded-full bg-white/10 px-4 py-2 text-sm font-semibold text-white transition hover:bg-white/20">How it works</button>
            </div>

            <div class="mt-6 grid gap-6 lg:grid-cols-[2fr,3fr]">
                <form id="macroForm" class="grid gap-4 rounded-3xl bg-slate-950/40 p-5">
                    <label class="grid gap-2 text-sm font-semibold uppercase tracking-wide text-indigo-200">
                        Macro Name
                        <input id="macroName" type="text" class="rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-white placeholder:text-indigo-100/50 focus:border-white/40 focus:outline-none focus:ring-2 focus:ring-white/30" placeholder="Bedtime Routine" required />
                    </label>

                    <label class="grid gap-2 text-sm font-semibold uppercase tracking-wide text-indigo-200">
                        Steps
                        <div class="rounded-2xl border border-dashed border-white/20 bg-white/5 px-4 py-4 text-sm text-indigo-100">
                            <p class="text-xs uppercase tracking-wide text-indigo-200/80">Add step</p>
                            <div class="mt-3 flex flex-col gap-3 sm:flex-row">
                                <select id="macroActionType" class="flex-1 rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-white focus:border-white/40 focus:outline-none focus:ring-2 focus:ring-white/30">
                                    <option value="key">Press Remote Key</option>
                                    <option value="launch">Launch App</option>
                                    <option value="delay">Wait</option>
                                </select>
                                <input id="macroActionValue" type="text" class="flex-1 rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-white placeholder:text-indigo-100/50 focus:border-white/40 focus:outline-none focus:ring-2 focus:ring-white/30" placeholder="Key (Home) / App ID (12) / Milliseconds (1000)" />
                                <button type="button" onclick="addMacroStep()" class="rounded-2xl bg-white px-5 py-3 text-base font-semibold text-indigo-600 shadow-lg transition hover:bg-indigo-50">Add Step</button>
                            </div>
                        </div>
                    </label>

                    <ul id="macroStepsPreview" class="min-h-[80px] space-y-3 rounded-2xl bg-indigo-950/30 p-4 text-sm text-indigo-100"></ul>

                    <div class="flex flex-col gap-3 sm:flex-row sm:justify-between">
                        <label class="flex items-center gap-2 text-sm text-indigo-100">
                            <input id="macroMarkFavorite" type="checkbox" class="h-4 w-4 rounded border-white/40 bg-white/10 text-indigo-500 focus:ring-white/40" />
                            Show in kid mode as the Magic Button
                        </label>
                        <button type="submit" class="rounded-2xl bg-primary px-6 py-3 text-base font-bold text-white shadow-lg transition hover:bg-primary-dark">Save Macro</button>
                    </div>
                </form>

                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-white">Saved Macros</h3>
                    <div id="macroList" class="grid gap-3"></div>
                </div>
            </div>
        </section>
    </main>

    <nav id="bottomTabNav" class="fixed inset-x-0 bottom-0 z-40 hidden bg-slate-950/80 text-white backdrop-blur-lg">
        <div id="bottomTabButtons" class="mx-auto flex w-full max-w-4xl items-stretch justify-around gap-2 px-4 py-3"></div>
    </nav>

    <div id="toastContainer" class="pointer-events-none fixed left-1/2 top-6 z-50 hidden -translate-x-1/2 transform"></div>

    <div
        id="timerOverlay"
        class="timer-overlay fixed inset-0 z-50 hidden items-center justify-center px-6 py-12 text-white">
        <div class="w-full max-w-md rounded-3xl bg-white/10 p-8 shadow-2xl">
            <div class="flex items-start justify-between gap-4">
                <div>
                    <h2 class="text-2xl font-bold">Magic Circle Timer</h2>
                    <p id="timerLabel" class="mt-1 text-sm text-indigo-100">Countdown in progress‚Ä¶</p>
                </div>
                <button
                    onclick="cancelToddlerTimer()"
                    class="rounded-full bg-white/15 px-3 py-2 text-xs font-semibold uppercase tracking-wide text-white transition hover:bg-white/25 focus:outline-none focus:ring-2 focus:ring-white/40">
                    Cancel
                </button>
            </div>

            <div class="relative mx-auto mt-8 flex h-56 w-56 items-center justify-center">
                <svg class="absolute inset-0 h-full w-full" viewBox="0 0 120 120" aria-hidden="true">
                    <circle cx="60" cy="60" r="54" stroke="rgba(255,255,255,0.2)" stroke-width="10" fill="none"></circle>
                    <circle id="timerProgressCircle" class="timer-circle" cx="60" cy="60" r="54" stroke="url(#timerGradient)" stroke-width="10" stroke-linecap="round" stroke-dasharray="339.292" stroke-dashoffset="339.292" fill="none"></circle>
                    <defs>
                        <linearGradient id="timerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#c4b5fd"></stop>
                            <stop offset="100%" stop-color="#7dd3fc"></stop>
                        </linearGradient>
                    </defs>
                </svg>
                <div class="relative flex flex-col items-center justify-center text-center">
                    <span id="timerCountdown" class="text-4xl font-extrabold tracking-tight">00:00</span>
                    <span class="mt-1 text-xs uppercase tracking-[0.4em] text-indigo-100">Remaining</span>
                </div>
            </div>

            <button
                id="timerOverlayDismiss"
                onclick="cancelToddlerTimer()"
                class="mt-8 w-full rounded-2xl bg-white px-5 py-3 text-base font-semibold text-indigo-600 shadow-lg transition hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-white/60">
                Tap to stop timer
            </button>
        </div>
    </div>

    <div
        id="fireworksOverlay"
        class="fireworks-overlay fixed inset-0 z-40 hidden text-white">
        <div id="fireworksStage" class="fireworks-stage"></div>
        <div class="fireworks-content">
            <div class="space-y-3">
                <h2 class="text-4xl font-extrabold tracking-tight drop-shadow-lg">üéÜ Fireworks Celebration</h2>
                <p id="fireworksLabel" class="text-base font-semibold text-indigo-100 drop-shadow-md">Celebration time.</p>
            </div>
            <button
                onclick="stopFireworksShow()"
                class="rounded-full bg-white/20 px-6 py-3 text-xs font-semibold uppercase tracking-[0.35em] text-white shadow-lg transition hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/50">
                End Fireworks
            </button>
        </div>
    </div>

    <script src="vendor/confetti.js"></script>
    <script src="app.js"></script>
</body>
</html>
